---
title: SDK 0.7.8-RELEASE é‡å¤§æ›´æ–°
description: 0.7.8-RELEASE é‡å¤§æ›´æ–°å’Œè¿ç§»æ­¥éª¤
---

[English](./0.7.8.md) | [ç®€ä½“ä¸­æ–‡](./0.7.8_cn.md)

ğŸ’ å¦‚æœä½ å°šæœªä½¿ç”¨ `ApiHug` é¢†åŸŸå®ä½“å¯¹è±¡ç®¡ç†(ORM), é‚£ä¹ˆè¿™æ¬¡å‡çº§æš‚ä¸ä¼šå½±å“ä½ ï¼Œä½†æœ€å¥½å’Œå®˜æ–¹ä¿æŒæœ€æ–°ç»Ÿä¸€ç‰ˆæœ¬! :-)

æœ€æ–°: <a target="_blank" href="https://search.maven.org/artifact/com.apihug/it-bom"><img src="https://img.shields.io/maven-central/v/com.apihug/it-bom.svg?label=Maven%20Central" /></a>

`0.7.8-RELEASE` æ·»åŠ åŠŸèƒ½:

- å°† `Repository` æ‰©å±•, è¿ç§»åˆ°ç‹¬ç«‹çš„  `trait` ç›®å½•ç®¡ç†, ä½¿ä»£ç ç»“æ„æ›´ç®€å•æ¸…æ™°;
- `lite` æ¨¡å¼ä½œä¸º `stub` é»˜è®¤ç¼–è¯‘æ¨¡å¼ï¼Œå°†ä½¿ä»–æ›´è¿…æ·;

![domain design](../../public/image/framework/domain.jpg)

## Repository è¿ç§»

ç›®çš„:

1. ä½¿ `repository` æ›´ç›´æ¥ç®€å•.
2. ä½¿ `repository` æ‰©å±•æ›´æ–¹ä¾¿ç»´æŠ¤.

ä¸¾ä¸ªåœ¨ä½ æ¨¡å—  `book-app` å·²å­˜åœ¨ çš„ `repository`ä¸ºä¾‹: `com.novel.book.wire.domain.book.repository.BookAuthorRepository`:

**ç°æœ‰é€»è¾‘åœ¨**:  `book-app\src\main\stub\com\novel\book\wire\domain\book\repository\BookAuthorRepository`:

```java
@Repository
@SuppressWarnings("Duplicates")
public interface BookAuthorRepository
    extends HopeJdbc<BookAuthor>,
        BookJdbcSupport,
        BookAuthorDSL,
        ListCrudRepository<BookAuthor, Long> {

  @Derived
  @Query
  Optional<BookAuthor> findByName(final String name);

  //Other method
}
```

âš ï¸âš ï¸âš ï¸ é¦–å…ˆä¿è¯ä½ çš„ `@Derived` å·²ç»å¤‡ä»½ï¼Œ åœ¨ä½ è·‘ `stub` å‘½ä»¤å‰;(å¦‚æœç‰ˆæœ¬ç®¡ç†ï¼Œå…ˆcommitä¸ºå¦™)

å› ä¸ºå‡çº§åçš„ `stub` åªä¿ç•™çº¯ `generated`ä»£ç , ä¹Ÿå°±æ˜¯`stub` å‘½ä»¤åï¼Œä»»ä½•`stub`ç›®å½•ä¸‹æ‰‹åŠ¨ä»£ç éƒ½å°†è¢«æ¸…é™¤.

### Step1

è·‘ä¸‹æœ¬æ¨¡å—çš„ `stub` å‘½ä»¤ï¼Œ é¦–å…ˆä¿è¯ä½ SDK ç‰ˆæœ¬å·²ç»è¢«æ›´æ–°åˆ° `0.7.8-RELEASE`+,  `gradle\libs.versions.toml`:

```toml

[versions]
# libraries
apihug = "0.7.8-RELEASE"

```

å‘½ä»¤è¡Œå¯ä»¥åˆ°ä½ é¡¹ç›®çš„ `README.md` æ‰¾åˆ°:

```shell

./gradlew.bat book-app:clean stub build -x test -x stubTest

```

è·‘å®Œåä½ ä¼šçœ‹åˆ°ä¸€ä¸ªæ–°çš„ `sourceSet`: `book-app\src\main\trait`;

ğŸ’â€â™€ï¸ ä½ å¯èƒ½éœ€è¦åˆ°ä½ çš„ gradle tool window è§¦å‘æœ¬é¡¹ç›®çš„ `Reload Gradle Project` ï¼Œå¦åˆ™å¯èƒ½æé†’ `book-app\src\main\trait` ä¸èƒ½è¢«å½“åš `sourceSet`!

### Step2

1. æ‰‹åŠ¨å°† `@Derived` copy å›åˆ° `_BookAuthorRepository`(trait ç›®å½•ä¸‹) & `BookAuthorRepository`(stub ç›®å½•)(åªæœ‰ç¬¬ä¸€æ¬¡è¿ç§»éœ€è¦ï¼Œä»¥ååªéœ€è¦åœ¨ `_BookAuthorRepository` ç¼–å†™);
2. å†æ¬¡å¯åŠ¨ `stub` å‘½ä»¤.

ä»ä»Šå¾€åï¼Œ æ‰€æœ‰Repositoryæ‰©å±• `@Derived` æ–¹æ³•, éƒ½åœ¨ç‹¬ç«‹ `book-app\src\main\trait` ç›®å½•ç»´æŠ¤ï¼š

1. `stub` å‘½ä»¤å°†ä½ éœ€è¦èå…¥(trait)çš„æ–¹æ³•ï¼ˆä¹Ÿå°±æ˜¯è€çš„`@Derived`æ–¹æ³•ï¼‰åˆè¿›åˆ°è¿è¡Œæ—¶çš„ `BookAuthorRepository` ç±»
2. é¿å… `BookAuthorRepository` åœ¨æŒç»­å¼€å‘ä¸­æ¨¡æ¿å’Œæ‰©å±•é€»è¾‘å†²çªï¼Œä¿æŒä»–çš„ç®€å•å’Œç›´è§‚.
3. ä¹Ÿå¾ˆå®¹æ˜“ç»´æŠ¤æˆ‘ä»¬çš„ repositoryæ‰©å±•æ¥å£, è¿™é‡Œä¿æŒçº¯çš„ SQL é€»è¾‘;

### StepX

å¦å¤–ä¸€ç§è¿ç§»æ–¹å¼ï¼Œ æ›´å¤šæ‰‹åŠ¨å·¥ä½œï¼Œä½†æ˜¯æ›´æ¸…æ™°;

1. åˆ›å»ºç›®å½• `book-app\src\main\trait`
2. åˆ›å»º åŒ… package `t.com.novel.book.wire.domain.book.repository`: åŸåŒ…`com.novel.book.wire.domain.book.repository`åŠ ä¸ªå‰ç¼€ `t.`;
3. æ·»åŠ æ¥å£ `interface _BookAuthorRepository` :åŸæ¥å£ `BookAuthorRepository`å‰ç¼€  `_` (ä¸‹åˆ’çº¿);
4. æ·»åŠ æ‰©å±• `extends BookAuthorRepository` (æ–¹ä¾¿ç¼–è¾‘å™¨æç¤º)
5. å°† `BookAuthorRepository` é‡Œæ‰€æœ‰ `@Derived` æ–¹æ³•æ‹·è´ä¸€ä»½åˆ° `_BookAuthorRepository`
6. æ‰§è¡Œ `stub` å‘½ä»¤

è¿™ä¸ªé€‚åˆæœ‰é™çš„ `repository` ç±»è¿ç§»æ¯”å¦‚å°‘äº30ä¸ª;

---

**çœŸå®**é¡¹ç›®çš„ç›®å½•ç»“æ„:

```shell
+---java
|   \---com
|       \---novel
|           \---book
+---stub
|   \---com
|       \---novel
|           \---book
|               \---wire
|                   \---domain
|                       +---account
|                       |   +---dsl
|                       |   \---repository
|                       +---book
|                       |   +---dsl
|                       |   \---repository
|                       \---job
|                           +---dsl
|                           \---repository
\---trait
    \---t
        \---com
            \---novel
                \---book
                    \---wire
                        \---domain
                            +---account
                            |   \---repository
                            +---book
                            |   \---repository
                            \---job
                                \---repository
```

## PS

è‡ª SDK ç‰ˆæœ¬`0.8.5-RELEASE`, å¼•å…¥ä¸€ç§æ›´å¥½æ§åˆ¶ `Repository` æ‰©å±•æ–¹æ³•çš„æ–¹å¼;

å½“åœ¨ `proto` æ·»åŠ äº†æ–°å®ä½“åï¼Œ è¿è¡Œ `stub` å‘½ä»¤ï¼Œä½ å°†ä¼šåœ¨ `trait` å¾—åˆ°ä¸€ä¸ªç©ºçš„ **Repository**:

```java
/**
 * NEVER try to use this class directly, keep it as an interface(default, no public), all body of
 * this interface will be merger to {@link JobEntityRepository} after {@code stub };
 *
 * <p>NEVER try to Overwrite parent {@link JobEntityRepository } or {@link
 * org.springframework.data.repository.ListCrudRepository} 's default method!!
 *
 * @see JobEntityRepository
 * @see com.novel.book.wire.domain.job.JobEntity
 */
interface _JobEntityRepository extends JobEntityRepository {

  /** Please put your customized SQL here, any SQL other place will be dropped after merger! */
  interface _DerivedSQL {}
}
```

ç„¶åæ·»åŠ ä¸€ä¸ªæ‰©å±• DAO æ¥å£:

```java
@Overwrite
default void myDaoApi(){
    
}
```

è®°å¾—æ·»åŠ  `@Overwrite` ï¼Œ IDEA ç¼–è¾‘å™¨å°†æé†’ä½  `Pull method 'myDaoApi' to 'JobEntityRepository'`

æŒ‰ç…§æç¤ºæ‰§è¡Œï¼Œæ–¹æ³•å°†è¢«æå‡åˆ°çˆ¶æ¥å£é‡Œé¢, é‡‡ç”¨è¿™ä¸ªæŠ€å·§å¯ä»¥é¿å…å¤šè·‘ä¸€æ¬¡ `stub` å‘½ä»¤;

ä¸‹æ¬¡å½“æ‰§è¡Œ `stub` å‘½ä»¤æ—¶å€™, é€»è¾‘å’Œä»£ç è¿˜æ˜¯ä¸€è‡´çš„.

## Best Tips

ä½ å¯ä»¥æŠŠ `_BookAuthorRepository` æƒ³è±¡æˆ `BookAuthorRepository`çš„`ä¼´ç”Ÿç±»`(è™½ç„¶æœ‰ç»§æ‰¿å…³ç³»ï¼šæ–¹ä¾¿è·å¾—ç¼–è¾‘å™¨æç¤º) ;

åªæ˜¯ `ApiHug` å·¥å…·é“¾å®Œå…¨å¸®ä½ å¤„ç†æ‰äº†è¿‡ç¨‹çš„å¤æ‚æ€§!

å‚è€ƒScala `ä¼´ç”Ÿå¯¹è±¡` [Companion objects](https://docs.scala-lang.org/scala3/book/domain-modeling-tools.html#companion-objects);

å¦‚æœä½ è¿‡ç¨‹ä¸­é‡åˆ°ä»»ä½•é—®é¢˜ï¼Œè¯·å‚è¯¢æˆ‘ä»¬:

![api-hug-contact](../../public/image/apihug-001.gif)
